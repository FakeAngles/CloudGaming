"--// Environment Setup\r\n\r\ngetgenv().TankESP = {}  -- Глобальная переменная для предотвращения дублирования\r\nlocal Environment = getgenv().TankESP\r\n\r\n--// Services\r\n\r\nlocal StarterGui = game:GetService(\"StarterGui\")\r\nlocal RunService = game:GetService(\"RunService\")\r\nlocal UserInputService = game:GetService(\"UserInputService\")\r\nlocal Camera = game:GetService(\"Workspace\").CurrentCamera\r\nlocal Players = game:GetService(\"Players\")\r\nlocal LocalPlayer = Players.LocalPlayer\r\nlocal SpawnedVehicles = game:GetService(\"Workspace\"):WaitForChild(\"SpawnedVehicles\")\r\n\r\n--// Cached Functions\r\n\r\nlocal Drawingnew = Drawing.new\r\nlocal Vector2new = Vector2.new\r\n\r\n--// Variables\r\n\r\nlocal ESPLabels = {}  -- Таблица для хранения ESP элементов для каждой техники и игроков\r\nlocal Connections = {}  -- Таблица для хранения соединений\r\nlocal UnloadButton = nil  -- Кнопка для выгрузки скрипта\r\n\r\n--// Functions\r\n\r\nlocal function SendNotification(Title, Text, Duration)\r\n    pcall(function()\r\n        StarterGui:SetCore(\"SendNotification\", {\r\n            Title = Title,\r\n            Text = Text,\r\n            Duration = Duration or 3\r\n        })\r\n    end)\r\nend\r\n\r\nlocal function AddESPForVehicle(vehicle)\r\n    if ESPLabels[vehicle] then return end  -- Не добавляем повторно ESP для одной и той же техники\r\n\r\n    local ESPLabel = Drawingnew(\"Text\")\r\n    ESPLabel.Visible = false\r\n    ESPLabel.Size = 18\r\n    ESPLabel.Color = Color3.fromRGB(255, 0, 0)  -- Красный цвет для выделения\r\n    ESPLabel.Center = true\r\n    ESPLabel.Outline = true\r\n    ESPLabel.Text = vehicle.Name  -- Уникальное название для каждого танка\r\n    ESPLabel.Position = Vector2new(0, 0)\r\n    ESPLabels[vehicle] = { Label = ESPLabel, Type = \"Vehicle\" }\r\nend\r\n\r\nlocal function AddESPForPlayer(player)\r\n    if ESPLabels[player] or player == LocalPlayer or player.Team == LocalPlayer.Team or player.Neutral then return end  -- Не добавляем повторно ESP и только для врагов\r\n\r\n    local ESPLabel = Drawingnew(\"Text\")\r\n    ESPLabel.Visible = false\r\n    ESPLabel.Size = 18\r\n    ESPLabel.Color = Color3.fromRGB(0, 255, 0)  -- Зеленый цвет для выделения врагов\r\n    ESPLabel.Center = true\r\n    ESPLabel.Outline = true\r\n    ESPLabels[player] = { Label = ESPLabel, Type = \"Player\" }\r\nend\r\n\r\nlocal function UpdateESP()\r\n    -- Проверяем каждую технику в SpawnedVehicles и добавляем ESP, если он еще не добавлен\r\n    for _, vehicle in pairs(SpawnedVehicles:GetChildren()) do\r\n        if vehicle:IsA(\"Model\") and vehicle:FindFirstChildWhichIsA(\"BasePart\") and not ESPLabels[vehicle] then\r\n            AddESPForVehicle(vehicle)\r\n        end\r\n    end\r\n\r\n    -- Проверяем каждого игрока и добавляем ESP, если он враг\r\n    for _, player in pairs(Players:GetPlayers()) do\r\n        if player ~= LocalPlayer and player.Team ~= LocalPlayer.Team and not player.Neutral and not ESPLabels[player] then\r\n            AddESPForPlayer(player)\r\n        end\r\n    end\r\nend\r\n\r\nlocal function AddESP()\r\n    -- Создаем ESP для каждой техники в SpawnedVehicles и для вражеских игроков\r\n    UpdateESP()\r\n\r\n    -- Подключаемся к RenderStepped, чтобы обновлять позиции текста\r\n    Connections.RenderConnection = RunService.RenderStepped:Connect(function()\r\n        for entity, data in pairs(ESPLabels) do\r\n            local ESPLabel = data.Label\r\n            if entity and entity.Parent then\r\n                if data.Type == \"Vehicle\" and entity:IsA(\"Model\") and entity:FindFirstChildWhichIsA(\"BasePart\") then\r\n                    local primaryPart = entity.PrimaryPart or entity:FindFirstChildWhichIsA(\"BasePart\")\r\n                    local distanceToNearestEnemy = math.huge\r\n                    local nearestEnemy = nil\r\n\r\n                    for _, player in pairs(Players:GetPlayers()) do\r\n                        if player.Team ~= LocalPlayer.Team and not player.Neutral and player.Character and player.Character:FindFirstChild(\"HumanoidRootPart\") then\r\n                            local distance = (primaryPart.Position - player.Character.HumanoidRootPart.Position).Magnitude * 0.28\r\n                            if distance \u003C distanceToNearestEnemy then\r\n                                distanceToNearestEnemy = distance\r\n                                nearestEnemy = player\r\n                            end\r\n                        end\r\n                    end\r\n\r\n                    if nearestEnemy and distanceToNearestEnemy \u003C= 5 then\r\n                        local Vector, OnScreen = Camera:WorldToViewportPoint(primaryPart.Position)\r\n                        if OnScreen then\r\n                            ESPLabel.Visible = true\r\n                            ESPLabel.Position = Vector2new(Vector.X, Vector.Y + 20)  -- Смещаем позицию ниже, чтобы не накладываться на игрока\r\n                            ESPLabel.Text = string.format(\"%s (%.2f м)\", entity.Name, (primaryPart.Position - LocalPlayer.Character.HumanoidRootPart.Position).Magnitude * 0.28)  -- Показываем название техники и расстояние до ближайшего врага\r\n                        else\r\n                            ESPLabel.Visible = false\r\n                        end\r\n                    else\r\n                        ESPLabel.Visible = false\r\n                    end\r\n                elseif data.Type == \"Player\" and entity:IsA(\"Player\") and entity.Character and entity.Character:FindFirstChild(\"HumanoidRootPart\") and entity.Character:FindFirstChild(\"Humanoid\") and entity.Character.Humanoid.Health > 0 then\r\n                    local humanoidRootPart = entity.Character.HumanoidRootPart\r\n                    local Vector, OnScreen = Camera:WorldToViewportPoint(humanoidRootPart.Position)\r\n                    if OnScreen then\r\n                        ESPLabel.Visible = true\r\n                        ESPLabel.Position = Vector2new(Vector.X, Vector.Y)\r\n                        local isNearVehicle = false\r\n\r\n                        for _, vehicle in pairs(SpawnedVehicles:GetChildren()) do\r\n                            if vehicle:IsA(\"Model\") and vehicle:FindFirstChildWhichIsA(\"BasePart\") then\r\n                                local primaryPart = vehicle.PrimaryPart or vehicle:FindFirstChildWhichIsA(\"BasePart\")\r\n                                local distance = (primaryPart.Position - humanoidRootPart.Position).Magnitude * 0.28\r\n                                if distance \u003C= 5 then\r\n                                    isNearVehicle = true\r\n                                    break\r\n                                end\r\n                            end\r\n                        end\r\n\r\n                        if not isNearVehicle then\r\n                            local distanceToLocalPlayer = (humanoidRootPart.Position - LocalPlayer.Character.HumanoidRootPart.Position).Magnitude * 0.28\r\n                            local health = entity.Character.Humanoid.Health\r\n                            ESPLabel.Text = string.format(\"%s (%.2f м) | HP: %.0f\", entity.Name, distanceToLocalPlayer, health)\r\n                        else\r\n                            local health = entity.Character.Humanoid.Health\r\n                            ESPLabel.Text = string.format(\"%s | HP: %.0f\", entity.Name, health)\r\n                        end\r\n                    else\r\n                        ESPLabel.Visible = false\r\n                    end\r\n                else\r\n                    ESPLabel.Visible = false\r\n                end\r\n            else\r\n                ESPLabel:Remove()\r\n                ESPLabels[entity] = nil\r\n            end\r\n        end\r\n    end)\r\n\r\n    -- Подключаемся к ChildAdded и ChildRemoved, чтобы автоматически добавлять и удалять ESP для новой техники\r\n    Connections.ChildAddedConnection = SpawnedVehicles.ChildAdded:Connect(function(child)\r\n        if child:IsA(\"Model\") and child:FindFirstChildWhichIsA(\"BasePart\") then\r\n            task.defer(function()  -- Используем task.defer для корректного добавления нового объекта\r\n                AddESPForVehicle(child)\r\n            end)\r\n        end\r\n    end)\r\n\r\n    Connections.ChildRemovedConnection = SpawnedVehicles.ChildRemoved:Connect(function(child)\r\n        if ESPLabels[child] then\r\n            ESPLabels[child].Label:Remove()\r\n            ESPLabels[child] = nil\r\n        end\r\n    end)\r\n\r\n    -- Подключаемся к PlayerAdded и PlayerRemoving, чтобы добавлять и удалять ESP для игроков\r\n    Connections.PlayerAddedConnection = Players.PlayerAdded:Connect(function(player)\r\n        if player.Team ~= LocalPlayer.Team and not player.Neutral then\r\n            task.defer(function()\r\n                AddESPForPlayer(player)\r\n            end)\r\n        end\r\n    end)\r\n\r\n    Connections.PlayerRemovingConnection = Players.PlayerRemoving:Connect(function(player)\r\n        if ESPLabels[player] then\r\n            ESPLabels[player].Label:Remove()\r\n            ESPLabels[player] = nil\r\n        end\r\n    end)\r\nend\r\n\r\nlocal function RemoveESP()\r\n    -- Отключаем соединение и удаляем элементы ESP\r\n    if Connections.RenderConnection then\r\n        Connections.RenderConnection:Disconnect()\r\n        Connections.RenderConnection = nil\r\n    end\r\n    if Connections.ChildAddedConnection then\r\n        Connections.ChildAddedConnection:Disconnect()\r\n        Connections.ChildAddedConnection = nil\r\n    end\r\n    if Connections.ChildRemovedConnection then\r\n        Connections.ChildRemovedConnection:Disconnect()\r\n        Connections.ChildRemovedConnection = nil\r\n    end\r\n    if Connections.PlayerAddedConnection then\r\n        Connections.PlayerAddedConnection:Disconnect()\r\n        Connections.PlayerAddedConnection = nil\r\n    end\r\n    if Connections.PlayerRemovingConnection then\r\n        Connections.PlayerRemovingConnection:Disconnect()\r\n        Connections.PlayerRemovingConnection = nil\r\n    end\r\n    for _, data in pairs(ESPLabels) do\r\n        data.Label.Visible = false\r\n        data.Label:Remove()\r\n    end\r\n    ESPLabels = {}\r\n    if UnloadButton then\r\n        UnloadButton:Destroy()\r\n        UnloadButton = nil\r\n    end\r\nend\r\n\r\nlocal function AddUnloadButton()\r\n    -- Создаем ScreenGui, если его нет\r\n    local playerGui = game:GetService(\"Players\").LocalPlayer:WaitForChild(\"PlayerGui\")\r\n    local screenGui = playerGui:FindFirstChild(\"TankESPGui\")\r\n    if not screenGui then\r\n        screenGui = Instance.new(\"ScreenGui\")\r\n        screenGui.Name = \"TankESPGui\"\r\n        screenGui.Parent = playerGui\r\n    end\r\n\r\n    -- Добавляем кнопку для выгрузки скрипта\r\n    UnloadButton = Instance.new(\"TextButton\")\r\n    UnloadButton.Size = UDim2.new(0, 200, 0, 50)\r\n    UnloadButton.Position = UDim2.new(0, 10, 0, 10)\r\n    UnloadButton.Text = \"Выгрузить Tank ESP\"\r\n    UnloadButton.Parent = screenGui\r\n    UnloadButton.BackgroundColor3 = Color3.fromRGB(255, 0, 0)\r\n    UnloadButton.TextColor3 = Color3.fromRGB(255, 255, 255)\r\n    UnloadButton.MouseButton1Click:Connect(function()\r\n        RemoveESP()\r\n        SendNotification(\"Tank ESP\", \"Скрипт успешно выгружен!\", 3)\r\n        getgenv().TankESP = nil\r\n    end)\r\n\r\n    end\r\n\r\n--// Main\r\n\r\nAddESP()\r\nAddUnloadButton()\r\nSendNotification(\"Tank ESP\", \"Скрипт успешно активирован!\", 5)\r\n"
